<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <script>
      class Permissions {
        plist = []
        als = []
        pkey = ""
        static isArr(a) {
          return Array.isArray(a)
        }
        static randomAlist(length = 10) {
          const type = typeof length === "number"
          const len = type ? length : 10
          const buffer = new ArrayBuffer(len * 8)
          const arr = new BigUint64Array(buffer)
          let val = 1n
          arr[0] = val
          let i = 0
          while (i++ < len) {
            val = val << 2n
            arr[i] = val
          }
          return arr
        }
        constructor({ Plist = [], pkey = "k", length = 16 }) {
          const type = typeof Plist === "number"
          const isArr = Permissions.isArr(Plist)
          if (!type && !isArr) return Error("plist error")
          this.plist = type ? [Plist] : isArr ? Plist : []
          this.als = Permissions.randomAlist(length)
          this.pkey = pkey
        }
        getAuth(user) {
          const ls = []
          for (const ite of this.als) {
            BigInt(user) & ite && ls.push(ite)
          }
          return ls
        }
        getAuthAll() {
          let i = -1
          let count = 0n
          const lsMap = { 0: count }
          while (i++ < this.als.length - 1) {
            const cur = this.als[i]
            count += BigInt(cur)
            const a1 = cur ^ 1n
            const a2 = count ^ 1n
            a1 && (lsMap[a1] = a1)
            a2 && (lsMap[a2] = a2)
            cur && (lsMap[cur] = cur)
            count && (lsMap[count] = count)
          }
          return Object.values(lsMap)
        }
        main(lss = null) {
          const pdict = {},
            ls = lss || this.plist
          for (const ite of ls) {
            const ele = this.getAuth(ite)
            pdict[this.pkey + ite] = this.als.reduce((p, k) => {
              p[this.pkey + k] = ele.includes(k)
              return p
            }, {})
          }
          return pdict
        }
      }
      const a = new Permissions({ length: 30 })
      console.log(a)
      console.log(a.getAuthAll())
      console.log(a.main([0, 1, 5, 4, 16, 17, 20, 21,384307168202282325]))
    </script>
  </body>
</html>
