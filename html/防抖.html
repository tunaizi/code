<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>防抖节流</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        list-style: none;
      }
      .item {
        height: 200px;
        width: 100%;
        background-color: #b6c1c9;
        margin-top: 10px;
      }
    </style>
  </head>

  <body>
    <input id="msg" />
    <button id="btn">发送</button>
    <span id="count"></span>
    <div id="box" style="width: 600px; margin: 0 auto">
      <div class="item">1</div>
      <div class="item">2</div>
      <div class="item">3</div>
      <div class="item">4</div>
      <div class="item">5</div>
      <div class="item">6</div>
    </div>
  </body>
  <script>
    //防抖 主要是时间控制   指定的时间只能做一次  短信验证码 60秒内只发送一次
    //留言板  弹幕  新增的提交  要限制
    let msgInput = document.getElementById("msg");
    let btn = document.getElementById("btn");
    let countSpan = document.getElementById("count");
    // let count = 10
    // let fn = function () {
    //   btn.disabled = true
    //   btn.onclick = null //按钮的绑定值消息
    //   let msg = msgInput.value
    //   countSpan.innerHTML = count
    //   btn.timer = setInterval(() => {
    //     count--
    //     countSpan.innerHTML = count
    //     if (count == 0) {
    //       countSpan.innerHTML = ''
    //       clearInterval(btn.timer)
    //       count = 10
    //       btn.disabled = false
    //       btn.onclick = fn //把事件重新绑定
    //     }
    //   }, 1000)
    // }

    // btn.onclick = fn
    //节流
    const fun = () => {
      console.log("00000000000000000000000000");
      clearTimeout(document.timer);
      document.timer = setTimeout(() => {
        console.log("345634634");
      }, 1000);
    };
    btn.onclick = fun;

    //节流
    //2000全部高度
    //1000可视高度
    //滚动1000就到了底部
    document.onscroll = () => {
      console.log("00000000000");
      let scrollTop = document.documentElement.scrollTop; //滚动条的高度
      let allHeight = document.documentElement.scrollHeight; //全部高度
      let clientHeight = document.documentElement.clientHeight; //可视高度
      let maxHeigth = allHeight - clientHeight;
      if (scrollTop > maxHeigth - 30) {
        //当距离底部 还有30个像素的时候  开始加载或者请求数据
        console.log("到达底部了");
        clearTimeout(document.timer);
        document.timer = setTimeout(() => {
          let div = document.createElement("div");
          div.className = "item";
          div.innerHTML = "请求来的";
          div.style.backgroundColor = "#6dbd38";
          document.getElementById("box").appendChild(div);
          console.log("5444444444444");
        }, 1000);
      }
    };
  </script>
</html>
