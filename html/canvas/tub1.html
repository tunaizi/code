<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Document</title>
  <style>
    html {
      height: 100%;
    }

    body {
      margin: 0;
      height: 100%;
      background: #fff;
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <canvas id="canvas"></canvas>

  <script>
    // 参考资料：https://github.com/sunshine940326/canvas-nest

    class Circle {
      opacitys = {
        100: "FF",
        99: "FC",
        98: "FA",
        97: "F7",
        96: "F5",
        95: "F2",
        94: "F0",
        93: "ED",
        92: "EB",
        91: "E8",
        90: "E6",
        89: "E3",
        88: "E0",
        87: "DE",
        86: "DB",
        85: "D9",
        84: "D6",
        83: "D4",
        82: "D1",
        81: "CF",
        80: "CC",
        79: "C9",
        78: "C7",
        77: "C4",
        76: "C2",
        75: "BF",
        74: "BD",
        73: "BA",
        72: "B8",
        71: "B5",
        70: "B3",
        69: "B0",
        68: "AD",
        67: "AB",
        66: "A8",
        65: "A6",
        64: "A3",
        63: "A1",
        62: "9E",
        61: "9C",
        60: "99",
        59: "96",
        58: "94",
        57: "91",
        56: "8F",
        55: "8C",
        54: "8A",
        53: "87",
        52: "85",
        51: "82",
        50: "80",
        49: "7D",
        48: "7A",
        47: "78",
        46: "75",
        45: "73",
        44: "70",
        43: "6E",
        42: "6B",
        41: "69",
        40: "66",
        39: "63",
        38: "61",
        37: "5E",
        36: "5C",
        35: "59",
        34: "57",
        33: "54",
        32: "52",
        31: "4F",
        30: "4D",
        29: "4A",
        28: "47",
        27: "45",
        26: "42",
        25: "40",
        24: "3D",
        23: "3B",
        22: "38",
        21: "36",
        20: "33",
        19: "30",
        18: "2E",
        17: "2B",
        16: "29",
        15: "26",
        14: "24",
        13: "21",
        12: "1F",
        11: "1C",
        10: "1A",
        9: "17",
        8: "14",
        7: "12",
        6: "0F",
        5: "0D",
        4: "0A",
        3: "08",
        2: "05",
        1: "03",
        0: "00",
      }
      //创建对象
      //以一个圆为对象
      //设置随机的 x，y坐标，r半径，_mx，_my移动的距离
      //this.r是创建圆的半径，参数越大半径越大
      //this._mx,this._my是移动的距离，参数越大移动
      constructor(x, y) {
        this.x = x
        this.y = y
        this.r = Math.random() * 6
        this._mx = Math.random()
        this._my = Math.random()
        this.color1 = this.setStrokeColor()
        this.color2 = this.setStrokeColor()
      }
      setStrokeColor(useOpacity = 80) {
        function setRgbTo16(str) {
          let reg = /^(rgb|RGB)/;
          if (!reg.test(str)) {
            return;
          }
          var arr = str.slice(4, str.length - 1).split(",");
          let color = "#";
          for (var i = 0; i < arr.length; i++) {
            var t = Number(arr[i]).toString(16);
            if (t == "0") {
              t = t + "0";
            }
            color += t;
          }
          return color;
        }
        const red = Number(Math.round(Math.random() * 255))
        const green = Number(Math.round(Math.random() * 255))
        const blue = Number(Math.round(Math.random() * 255))
        if (useOpacity) {
          return setRgbTo16(`rgb(${red},${green},${blue})`) + this.opacitys[String(Math.round(Math.random() * useOpacity))];
        }
        return setRgbTo16(`rgb(${red},${green},${blue})`);
      }
      //canvas 画圆和画直线
      //画圆就是正常的用canvas画一个圆
      //画直线是两个圆连线，为了避免直线过多，给圆圈距离设置了一个值，距离很远的圆圈，就不做连线处理
      drawCircle(ctx) {
        ctx.beginPath()
        /**
         **@disc: 以当前对象的x、y为圆心，r为半径，画一个圆
         **@author: mengln
         */
        ctx.arc(this.x, this.y, this.r, 0, 360)
        ctx.closePath()
        ctx.fillStyle = this.color1
        ctx.fill()
      }

      drawLine(ctx, _circle) {
        let dx = this.x - _circle.x
        let dy = this.y - _circle.y
        let d = Math.sqrt(dx * dx + dy * dy)
        if (d < 160) {
          ctx.beginPath()
          //创建从当前对象的x、y到达位置 _circle.x,_circle.y 的一条线：
          ctx.moveTo(this.x, this.y) //起始点
          ctx.lineTo(_circle.x, _circle.y) //终点
          ctx.closePath()
          ctx.strokeStyle = this.color2
          ctx.stroke()
        }
      }

      // 圆圈移动
      // 圆圈移动的距离必须在屏幕范围内
      move(w, h) {
        this._mx = this.x < w && this.x > 0 ? this._mx : -this._mx
        this._my = this.y < h && this.y > 0 ? this._my : -this._my
        this.x += this._mx / 2
        this.y += this._my / 2
      }
    }

    //鼠标点画圆闪烁变动
    class currentCirle extends Circle {
      constructor(x, y) {
        super(x, y)
      }
      drawCircle(ctx) {
        ctx.beginPath()
        //注释内容为鼠标焦点的地方圆圈半径变化
        // this.r = this.r < 14 && this.r > 1 ? this.r + (Math.random() * 2 - 1) : 2
        this.r = 8
        ctx.arc(this.x, this.y, this.r, 0, 360)
        ctx.closePath()
        // ctx.fillStyle = "rgba(0,0,0," + parseInt(Math.random() * 100) / 100 + ")"
        ctx.fillStyle = "rgba(255, 77, 54, 0.6)"
        ctx.fill()
      }
    }

    //更新页面用requestAnimationFrame替代setTimeout
    window.requestAnimationFrame =
      window.requestAnimationFrame ||
      window.mozRequestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      window.msRequestAnimationFrame

    let canvas = document.getElementById("canvas")
    let ctx = canvas.getContext("2d")
    let w = (canvas.width = canvas.offsetWidth)
    let h = (canvas.height = canvas.offsetHeight)
    let circles = []
    let current_circle = new currentCirle(0, 0)

    let draw = function () {
      ctx.clearRect(0, 0, w, h)
      for (let i = 0; i < circles.length; i++) {
        circles[i].move(w, h)
        circles[i].drawCircle(ctx)
        // 非当前光标外的所有圆之间，彼此划线
        for (j = i + 1; j < circles.length; j++) {
          circles[i].drawLine(ctx, circles[j])
        }
      }
      if (current_circle.x) {
        current_circle.drawCircle(ctx)
        // 当前光标和所有圆圈之间彼此划线
        for (var k = 0; k < circles.length; k++) {
          current_circle.drawLine(ctx, circles[k])
        }
      }
      requestAnimationFrame(draw)
    }

    let init = function (num) {
      for (var i = 0; i < num; i++) {
        circles.push(new Circle(Math.random() * w, Math.random() * h))
      }
      draw()
    }

    window.addEventListener("load", init(190))

    // window.onmousemove = function (e) {
    //   e = e || window.event
    //   current_circle.x = e.clientX
    //   current_circle.y = e.clientY
    // }

    // window.onmouseout = function () {
    //   current_circle.x = null
    //   current_circle.y = null
    // }
  </script>
</body>

</html>